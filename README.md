# openstack-victoria-basic-installer

Copyright 2021 Kasidit Chanchio 

Author: กษิดิศ ชาญเชี่ยว <br>
Contact: kasiditchanchio@gmail.com <br>

<p>
สคริปต์ได้รับการพัฒนาตามคู่มือติดตั้งระบบโอเพ่นสแตคที่ [1]
<p>
<h2> 1. การเตรียมคอมพิวเตอร์และระบบเครือข่ายสำหรับการติดตั้ง </h2>
<p>
<img src="documents/openstack-host-network.png">
<p>
ภาพ 1 โครงสร้างของเครื่องคอมพิวเตอร์และระบบเครือข่ายสำหรับติดตั้งระบบโอเพ่นสแตค <br>
<p>
ในการติดตั้งขอให้ผู้อ่านเตรียมเครื่องคอมพิวเตอร์ที่ใช้ระบบปฏิบัติการอูบุนตูเวอร์ชั่น 20.04  (Ubuntu 20.04) จำนวน 4 เครื่องเชื่อมต่อกันด้วยระบบเครือข่ายดังภาพที่ 1 ซึ่งประกอบไปด้วยเครื่องคอมพิวเตอร์ชื่อคอนโทลเลอร์ (controller)  เน็ตเวริค์ (network) คอมพิวต์ (compute) และคอมพิวต์หนึ่ง (compute1) (โดยที่ชื่อเครื่องต้องได้รับการกำหนดในระบบปฏิบัติการอูบุนตูและเช็คได้ด้วยคำสั่ง hostname) จากภาพผู้เขียนแนะนำให้ใช้เครื่องคอนโทรเลอร์มีสแปคซิฟิเคชั่น (Specification) ขั้นต่ำสำหรับการศึกษาคือ ซีพียู (CPU) จำนวน 4 คอร์ หน่วยความจำขนาด 8 GB มีพื้นที่ดิสค์สำหรับเก็บข้อมูลขนาดอย่างน้อย 100 GB สำหรับเครื่องเน็ตเวิร์คควรมี ซีพียูจำนวน 2 คอร์ หน่วยความจำ 2 GB พื้นที่ดิสค์ 50 GB สำหรับเครื่องคอมพิวต์ และคอมพิวต์หนึ่ง แต่ละเครื่องควรมี ซีพียู 4 คอร์ หน่วยความจำ 8 GB พื้นที่ดิสค์ 100 GB ในกรณีที่ผู้อ่านต้องการติดตั้งเพื่อใช้งานจริง ผู้เขียนขอแนะนำให้ศึกษาคู่มือการใช้งานจริงที่ [2]
<p>
ระบบปฏิบัติการติดตั้งบนแต่ละเครื่องควรได้รับการอับเดท (update) ให้เป็นอูบุนตู 20.04 เวอร์ชั่นล่าสุดและกำหนดให้ทุกเครื่องมีล็อกอิน (login) ชื่อ “opensatck” และรหัสผ่าน (password) คือ “openstack” และล็อกอินนี้จะต้องสามารถใช้คำสั่ง sudo ได้ นอกจากนั้นระบบปฏิบัติการของทุกๆเครื่องควรได้รับการตั้งเวลาที่ใกล้เคียงกัน
<p>
ในภาพ 1 คอมพิวเตอร์ทั้งสี่เครื่องมีหน้าที่ต่อไปนี้ 
<ul>
  <li>เครื่องคอนโทรเลอร์ ทำหน้าที่รันซอฟต์แวร์ส่วนประกอบที่ทำหน้ารองรับคำสั่งจากผู้ใช้ระบบ พิสูจน์ตัวตนของผู้ใช้ บริหารจัดการการใช้งานทรัพยากร และเป็นที่ตั้งของระบบฐานข้อมูลที่ใช้เก็บเมต้าดาต้าของทั้งระบบ
  <li>เครื่องเน็ตเวิร์ค ทำหน้าที่จัดการการสื่อสารข้อมูลระหว่าง วีเอ็มภายในระบบโอเพ่นสแตคที่รันอยู่บนเครื่องคอมพิวต์ และคอมพิวต์หนึ่ง กับระบบเครือข่ายภายนอกระบบโอเพ่นสแตค เช่นเครือข่ายอินเตอร์เน็ต เป็นต้น 
  <li>เครื่องคอมพิวต์ และคอมพิวต์หนึ่ง เป็นเครื่องที่ทำหน้าที่รันวีเอ็มของผู้ใช้ โดยที่ซอฟต์แวร์ส่วนประกอบของโอเพ่นสแตคบนเครื่องคอนโทลเลอร์จะตัดสินใจว่าจะรันวีเอ็มของผู้ใช้บนเครื่องคอมพิวต์เครื่องไหน 
</ul>
<p>
  ในการติดตั้งที่จะได้กล่าวถึงต่อไปผู้ติดตั้งจะต้องจัดเตรียมระบบเครือข่ายที่มีการเชื่อมต่อเครื่องคอมพิวเตอร์ทั้งสี่เครื่องดังต่อไปนี้ 
<ul>
<li>1.	ระบบเครือข่ายบริหารจัดการ (Management Network) : เป็นระบบเครือข่ายสำหรับให้ซอฟต์แวร์ส่วนประกอบของโอเพ่นสแตคบนคอมพิวเตอร์ที่เกี่ยวข้องใช้สื่อสารคำสั่งและข้อมูลเพื่อดำเนินการฟังก์ชั่นการทำงานต่างๆของระบบฯ นอกจากนั้นเครือข่ายนี้ยังใช้สำหรับการติดตั้งซอฟต์แวร์ด้วย
  <li>2.	ระบบเครือข่าย ดาต้าทัลเนิล (Data Tunnel Network) : เป็นระบบเครือข่ายที่โอเพ่นสแตคใช้สำหรับสื่อสารข้อมูลระหว่างวีเอ็ม (VM) ที่อาจถูกกำหนดให้รันบนต่างเครื่องโฮส และใช้สำหรับสื่อสารข้อมูลระหว่างวีเอ็ม และเร้าเตอร์เสมือนที่โอเพ่นสแตคสร้างขึ้นบนเครื่องเน็ตเวิร์คโฮส เพื่อส่งผ่านข้อมูลของวีเอ็มออกสู่ระบบเครือข่ายภายนอกและส่งผ่านข้อมูลจากระบบเครือข่ายภายนอกต่อให้วีเอ็ม
    <li>3.	ระบบเครือข่าย วีแลน (VLAN Network) : เป็นระบบเครือข่ายที่อนุญาตให้วีเอ็มเชื่อมต่อเพื่อสื่อสารข้อมูลกับ แอพพลิเคชั่นดังเดิม (Legacy Applications) ขององค์กรที่ใช้ระบบเครือข่ายแบบวีแลนสื่อสารกันอยู่แล้ว 
      <li>4.	ระบบเครือข่ายภายนอก (External Network) : เป็นระบบเครือข่ายที่องค์กรที่ใช้ระบบโอเพ่นสแตคใช้บริการอินเทอร์เน็ต โดยที่องค์กรจะต้องจัดสรรหมายเลขไอพีจำนวนเพื่อให้วีเอ็มในระบบโอเพ่นสแตคใช้สื่อสารกับระบบเครือข่ายอินเทอร์เน็ต
</ul>
<p>
  จากตัวอย่างการจัดเตรียมทรัพยากรสำหรับการติดตั้งในภาพ 1 ผู้ติดตั้งจะต้องกำหนดค่าต่อไปนี้ด้วยตนเองก่อนทำการติดตั้ง
  <ul>
    <li>1.	กำหนดให้เครือข่ายบริหารจัดการมีค่าสับเน็ต (Subnet) คือ 10.100.20.0/24 </li>
    <li>2.	เครื่องคอนโทรเลอร์เชื่อมต่อกับเครือข่ายนี้ผ่าน เน็ตเวิร์คอินเตอร์เฟสการด์ (Network Interface Card) หรือนิคส์ (NIC) ชื่อ ens3 โดยกำหนดให้มีค่าไอพี 10.100.20.11 โดยใช้เน็ตแพลน (netplan) </li>
    <li>3.	กำหนดให้เครื่องเน็ตเวิร์ค เครื่องคอมพิวต์และ คอมพิวต์หนึ่ง เชื่อมต่อกับเครือข่ายบริหารฯผ่านนิคส์ ens3 และกำหนดให้ทั้งสามเครื่องมีค่าไอพีคือ 10.100.20.21 10.100.20.31 และ 10.100.20.32 ตามลำดับ <li>
    <li>4.	กำหนดให้เครื่องเน็ตเวิร์คมีนิคส์ที่เชื่อมต่อกับระบบเครือข่ายอื่นๆอีกสามเครือข่าย ได้แก่ 1) ens4 ที่เชื่อมต่อกับเครือข่ายดาต้าทันเนิล 2) ens5 ที่เชื่อมต่อกับระบบเครือข่ายวีแลน และ 3) ens6 ที่เชื่อมต่อเครื่องเน็ตเวิร์คกับระบบเครือข่ายภายนอก </li>
    <li>5.	สำหรับเครื่องคอมพิวต์และคอมพิวต์หนึ่งนั้น กำหนดให้ทั้งสองเครื่องใช้นิคส์ ens4 เชื่อมต่อกับระบบเครือข่ายดาต้าทัลเนิล และใช้นิคส์ ens5 เชื่อมต่อกับเครือข่ายวีแลน </li>
  </ul>
  ผู้ติดตั้งไม่ต้องกำหนดค่าไอพีอื่นๆในภาพ 1 ที่เป็นอักษรตัวเอียงด้วยตนเองเหมือนที่ทำกับ ens3 แต่จะต้องระบุค่าที่ไอพีที่ต้องการในไฟล์กำหนดค่าของซอฟต์แวร์สคริปต์สำหรับติดตั้ง ดังที่จะได้กล่าวถึงต่อไป
<p>
<p>
<h2> 2. การติดตั้งโดยใช้สคริปต์ </h2>
<p>
ผู้เขียนได้พัฒนาเชลสคริปต์สำหรับติดตั้งระบบโอเพ่นสแตคสามเวอร์ชั่นดังแสดงในตารางที่ 7-1 โดยอ้างอิงข้อมูลคำสั่งที่ใช้จากคู่มืออย่างเป็นทางการที่ [1] ในการติดตั้งที่จะบรรยายต่อไปผู้เขียนจะใช้สคริปต์สำหรับติดตั้งระบบโอเพ่นสแตคเวอร์ชั่นวิคทอเรียซึ่งเป็นเวอร์ชั่นที่เชื่อถือได้เพราะได้รับการเผยแพร่และมีการแก้ไขข้อผิดพลาดหลังเผยแพร่มาเป็นระยะเวลาหนึ่งแล้ว
ผู้ติดตั้งเริ่มการติดตั้งโดยล๊อกอินเข้าสู่เครื่องคอนโทรเลอร์ และเรียกใช้ screen เพื่อสร้าง screen session เพื่อป้องกันการสูญเสียการเชื่อมต่อจากคอมพิวเตอร์ที่ผู้ติดตั้งใช้มายังเครื่องคอนโทลเลอร์ในกรณีที่ผู้ติดตั้งรีโมทล็อกอินเข้าสู่เครื่องคอมโทรเลอร์ หลังจากนั้นผู้ติดตั้งจะใช้ git utility เพื่อดาวโหลดสคริปสำหรับติดตั้งจาก github มาสู่ไดเรคทอรี $HOME/openstack-victoria-basic-installer โดยที่ในตัวอย่างการติดตั้งนี้ $HOME คือ /home/openstack 
<pre>
On controller: 
$ screen
$ git init
$ git clone https://github.com/kasidit/openstack-victoria-basic-installer
Cloning into 'openstack-victoria-basic-installer'...
$ ls
openstack-victoria-basic-installer
</pre>
<p>
  หลังจากนั้นให้ cd เข้าสู่ openstack-victoria-basic-installer และลิสต์ชื่อไฟล์และสับไดเรคทอรี
<pre>
On controller: 
$ cd openstack-victoria-basic-installer/
$ ls
config.d          example.install-paramrc.sh  LICENSE                  Untarfiles
Deployments  exe-config-installer.sh          OPSInstaller-init.tar  vmhosts-scripts
documents     install-paramrc.sh                 README.md
$ 
</pre>
<p>
  
UNDER CONSTRUCTION!


<h3>อ้างอิง</h3>
<p><p>
[1] https://docs.openstack.org/install-guide/ <br>
[2] https://docs.openstack.org/arch-design/ <br>
[3] https://mariadb.org <br>

  
